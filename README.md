# æå®¢æ—¶é—´ä¸“æ ä¸‹è½½å™¨

ä¸€é”®æ‰¹é‡ä¸‹è½½æå®¢æ—¶é—´ä¸“æ æ–‡ç« ä¸º PDF æˆ– EPUB æ ¼å¼ã€‚æ”¯æŒé€šè¿‡ `npx` ç›´æ¥è¿è¡Œ,æ— éœ€å®‰è£…ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **é›¶å®‰è£…**ï¼šæ”¯æŒ `npx` ç›´æ¥ä½¿ç”¨
- ğŸ“¦ **æ‰¹é‡ä¸‹è½½**ï¼šè‡ªåŠ¨è·å–æ•´ä¸ªä¸“æ çš„æ‰€æœ‰æ–‡ç« 
- ğŸ“„ **å®Œæ•´å†…å®¹**ï¼šè‡ªåŠ¨å¤„ç†æ»šåŠ¨å®¹å™¨ï¼Œç¡®ä¿åŒ…å«å®Œæ•´å†…å®¹
- ğŸ“š **å¤šç§æ ¼å¼**ï¼šæ”¯æŒ PDFã€EPUB æˆ–åŒæ—¶ç”Ÿæˆä¸¤ç§æ ¼å¼
- ğŸ”— **æ™ºèƒ½åˆå¹¶**ï¼šè‡ªåŠ¨å°†æ‰€æœ‰ç« èŠ‚åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œä»¥ä¸“æ åç§°å‘½åï¼ˆå¯é€‰ï¼‰
- âš™ï¸ **çµæ´»é…ç½®**ï¼šå‘½ä»¤è¡Œå‚æ•°æˆ–é…ç½®æ–‡ä»¶ï¼Œä»»é€‰å…¶ä¸€
- ğŸ¨ **å‹å¥½ç•Œé¢**ï¼šå½©è‰²è¿›åº¦æç¤ºï¼Œå®æ—¶æ˜¾ç¤ºä¸‹è½½çŠ¶æ€
- ğŸ§¾ **ä»£ç å—è¿˜åŸ**ï¼šè‡ªåŠ¨è¯†åˆ«æ»šåŠ¨å®¹å™¨/é«˜äº®ç»„ä»¶ï¼Œè¿˜åŸæˆæ ‡å‡†ä»£ç å—
- ğŸ–¼ï¸ **Kindle å‹å¥½å›¾ç‰‡**ï¼šè‡ªåŠ¨å°† WebP/AVIF ç­‰æ ¼å¼è½¬æ¢ä¸º PNGï¼Œå…¼å®¹ Send to Kindle

## ğŸš€ å¿«é€Ÿå¼€å§‹

## ğŸš€ ä½¿ç”¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œå‚æ•°æ–¹å¼ï¼ˆæ¨èï¼‰

ç›´æ¥é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šé…ç½®ï¼Œé€‚åˆä¸€æ¬¡æ€§ä½¿ç”¨ï¼š

```bash
npx @kadaliao/geektime-downloader \
  --url "https://time.geekbang.org/column/article/200822" \
  --cookie "ä½ çš„cookieå­—ç¬¦ä¸²"
```

### æ–¹å¼äºŒï¼šé…ç½®æ–‡ä»¶æ–¹å¼

åˆ›å»ºé…ç½®æ–‡ä»¶åï¼Œç›´æ¥è¿è¡Œå‘½ä»¤å³å¯ï¼Œé€‚åˆéœ€è¦å¤šæ¬¡ä½¿ç”¨çš„æƒ…å†µï¼š

1. åœ¨é¡¹ç›®ç›®å½•åˆ›å»º `config.json`ï¼š

```json
{
  "cookie": "ä½ çš„å®Œæ•´ cookie å­—ç¬¦ä¸²",
  "cookieFile": "./cookies.json",
  "columnUrl": "https://time.geekbang.org/column/article/200822"
}
```

> `cookieFile` å¯é€‰ï¼Œç”¨äºç›´æ¥å¼•ç”¨æµè§ˆå™¨å¯¼å‡ºçš„ `cookies.json`ã€‚

2. è¿è¡Œå‘½ä»¤ï¼š

```bash
npx @kadaliao/geektime-downloader
```

### æ–¹å¼ä¸‰ï¼šcookies.json æ–‡ä»¶å¯¼å…¥

é€‚åˆä»æµè§ˆå™¨æˆ–æ’ä»¶å¯¼å‡ºçš„ JSON Cookieï¼ˆå¦‚ Chrome çš„ Cookie-Editor å¯¼å‡ºï¼‰ï¼š

1. åœ¨æµè§ˆå™¨ä¸­ç™»å½•æå®¢æ—¶é—´ï¼Œä½¿ç”¨æ’ä»¶æˆ– DevTools å¯¼å‡º `cookies.json`
2. å°†æ–‡ä»¶æ”¾åœ¨å½“å‰ç›®å½•ï¼ˆæ–‡ä»¶åå¿…é¡»æ˜¯ `cookies.json`ï¼‰ï¼Œç¨‹åºä¼šè‡ªåŠ¨æ£€æµ‹  
   æˆ–è€…è¿è¡Œæ—¶æ˜¾å¼æŒ‡å®šï¼š`--cookie-file ./cookies.json`
3. å…¶ä»–å‚æ•°ä¸å‰ä¸¤ç§æ–¹å¼ä¸€è‡´

ç¤ºä¾‹ï¼š

```bash
npx @kadaliao/geektime-downloader \
  --url "https://time.geekbang.org/column/article/200822" \
  --cookie-file ./cookies.json
```

## ğŸ“– ä½¿ç”¨è¯´æ˜

### è·å– Cookie

1. æµè§ˆå™¨ç™»å½•æå®¢æ—¶é—´
2. æ‰“å¼€ä»»æ„ä¸“æ æ–‡ç« 
3. æŒ‰ **F12** æ‰“å¼€å¼€å‘è€…å·¥å…·
4. åˆ‡æ¢åˆ° **Networkï¼ˆç½‘ç»œï¼‰** æ ‡ç­¾
5. åˆ·æ–°é¡µé¢ï¼Œæ‰¾åˆ°ä»»æ„è¯·æ±‚
6. åœ¨ **Request Headers** ä¸­å¤åˆ¶å®Œæ•´ `Cookie` å€¼

### å‘½ä»¤è¡Œé€‰é¡¹

ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è¿è¡Œæœ¬å·¥å…·ï¼š

1. ä½¿ç”¨ `npx`ï¼ˆæ¨èï¼Œæ— éœ€å®‰è£…ï¼‰ï¼š
```bash
npx @kadaliao/geektime-downloader [é€‰é¡¹]
```

2. æˆ–è€…å…¨å±€å®‰è£…åä½¿ç”¨ï¼š
```bash
# å®‰è£…
npm install -g @kadaliao/geektime-downloader

# ä½¿ç”¨
geektime-dl [é€‰é¡¹]
```

å¯ç”¨é€‰é¡¹ï¼š
```
  -V, --version          æ˜¾ç¤ºç‰ˆæœ¬å·
  -u, --url <url>        ä¸“æ æ–‡ç« URLï¼ˆä»»æ„ä¸€ç¯‡ï¼‰
  -c, --cookie <cookie>  Cookieå­—ç¬¦ä¸²ï¼ˆç”¨äºè®¤è¯ï¼‰
      --cookie-file <path>  ä» JSON æ–‡ä»¶å¯¼å…¥ Cookieï¼ˆå¦‚ cookies.jsonï¼‰
  -o, --output <dir>     è¾“å‡ºç›®å½• (é»˜è®¤: "./downloads")
  -f, --format <format>  è¾“å‡ºæ ¼å¼: pdf, epub, both (é»˜è®¤: "pdf")
  --headless <boolean>   æ— å¤´æ¨¡å¼ (é»˜è®¤: true)
  --concurrency <number> å¹¶å‘ä¸‹è½½æ•°é‡ (é»˜è®¤: 5)
  --delay <ms>           æ¯ç¯‡æ–‡ç« é—´å»¶è¿Ÿ(ms) (é»˜è®¤: 2000)
  --timeout <ms>         é¡µé¢åŠ è½½è¶…æ—¶æ—¶é—´(ms) (é»˜è®¤: 60000)
  --dry-run              é¢„è§ˆæ¨¡å¼ï¼Œåªæ˜¾ç¤ºæ–‡ç« åˆ—è¡¨
  --limit <number>       é™åˆ¶ä¸‹è½½æ•°é‡ï¼ˆæµ‹è¯•ç”¨ï¼‰
  --no-merge             ç¦ç”¨PDFåˆå¹¶ï¼ˆé»˜è®¤ä¼šåˆå¹¶æ‰€æœ‰æ–‡ç« ä¸ºä¸€ä¸ªPDFï¼‰
  -h, --help             æ˜¾ç¤ºå¸®åŠ©
```

### ä½¿ç”¨ç¤ºä¾‹

**é¢„è§ˆæ–‡ç« åˆ—è¡¨**

```bash
npx @kadaliao/geektime-downloader \
  -u "https://time.geekbang.org/column/article/200822" \
  -c "your_cookie" \
  --dry-run
```

**æµ‹è¯•ä¸‹è½½**

```bash
npx @kadaliao/geektime-downloader \
  -u "https://time.geekbang.org/column/article/200822" \
  -c "your_cookie" \
  --limit 2
```

**ä¸‹è½½æ•´ä¸ªä¸“æ ï¼ˆPDF æ ¼å¼ï¼‰**

```bash
npx @kadaliao/geektime-downloader \
  -u "https://time.geekbang.org/column/article/200822" \
  -c "your_cookie"
```

**ä½¿ç”¨ cookies.jsonï¼ˆè‡ªåŠ¨æ£€æµ‹æˆ–æ‰‹åŠ¨æŒ‡å®šï¼‰**

```bash
npx @kadaliao/geektime-downloader \
  -u "https://time.geekbang.org/column/article/200822" \
  --cookie-file ./cookies.json
```

**ä¸‹è½½ä¸º EPUB æ ¼å¼**

```bash
npx @kadaliao/geektime-downloader \
  -u "https://time.geekbang.org/column/article/200822" \
  -c "your_cookie" \
  --format epub
```

**åŒæ—¶ç”Ÿæˆ PDF å’Œ EPUB**

```bash
npx @kadaliao/geektime-downloader \
  -u "https://time.geekbang.org/column/article/200822" \
  -c "your_cookie" \
  --format both
```

**è‡ªå®šä¹‰è¾“å‡ºç›®å½•**

```bash
npx @kadaliao/geektime-downloader \
  -u "https://..." \
  -c "..." \
  --output ~/Documents/æå®¢æ—¶é—´
```

**ç¦ç”¨ PDF åˆå¹¶ï¼ˆä»…ä¿ç•™å•ç‹¬ç« èŠ‚ï¼‰**

```bash
npx @kadaliao/geektime-downloader \
  -u "https://..." \
  -c "..." \
  --no-merge
```

## ğŸ“ è¾“å‡ºæ–‡ä»¶

ä¸‹è½½å®Œæˆåï¼Œä¼šåœ¨è¾“å‡ºç›®å½•ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

### PDF æ ¼å¼ï¼ˆ--format pdf æˆ– bothï¼‰

**å•ç‹¬ç« èŠ‚ PDFï¼ˆå§‹ç»ˆç”Ÿæˆï¼‰**

```
001_å¼€ç¯‡è¯___æƒ³åƒé€æ¶æ„ï¼Ÿä½ å¾—çœ‹çœ‹çœŸå®ã€æ¥åœ°æ°”çš„æ¶æ„æ¡ˆä¾‹.pdf
002_01___æ¶æ„çš„æœ¬è´¨ï¼šå¦‚ä½•æ‰“é€ ä¸€ä¸ªæœ‰åºçš„ç³»ç»Ÿï¼Ÿ.pdf
003_02___ä¸šåŠ¡æ¶æ„ï¼šä½œä¸ºå¼€å‘ï¼Œä½ çœŸçš„äº†è§£ä¸šåŠ¡å—ï¼Ÿ.pdf
```

- ä¸‰ä½æ•°å­—ç¼–å·ä¿æŒæ–‡ç« é¡ºåº
- è‡ªåŠ¨æ¸…ç†éæ³•å­—ç¬¦
- é™åˆ¶æ–‡ä»¶åé•¿åº¦

**åˆå¹¶åçš„ PDFï¼ˆé»˜è®¤ç”Ÿæˆï¼‰**

```
ä¸“æ åç§°.pdf
```

- é»˜è®¤ä¼šå°†æ‰€æœ‰ç« èŠ‚åˆå¹¶ä¸ºä¸€ä¸ªå®Œæ•´çš„ PDF æ–‡ä»¶
- æ–‡ä»¶åä¸ºä¸“æ çš„æ ‡é¢˜ï¼ˆè‡ªåŠ¨ä» API è·å–ï¼‰
- åŒ…å«æ‰€æœ‰æˆåŠŸä¸‹è½½çš„ç« èŠ‚ï¼ŒæŒ‰é¡ºåºæ’åˆ—
- è‡ªåŠ¨æ·»åŠ ä¹¦ç­¾å¯¼èˆª
- å¦‚ä¸éœ€è¦åˆå¹¶ç‰ˆæœ¬ï¼Œä½¿ç”¨ `--no-merge` é€‰é¡¹

### EPUB æ ¼å¼ï¼ˆ--format epub æˆ– bothï¼‰

```
ä¸“æ åç§°.epub
```

- æ ‡å‡† EPUB 3 æ ¼å¼
- å®Œæ•´çš„ç›®å½•å¯¼èˆª
- å“åº”å¼æ’ç‰ˆï¼Œé€‚åˆå„ç§é˜…è¯»å™¨
- è‡ªåŠ¨å¤„ç†å›¾ç‰‡å’Œä»£ç å—æ ·å¼
- è‡ªåŠ¨è½¬æ¢ Kindle ä¸æ”¯æŒçš„ WebP/AVIF å›¾ç‰‡æ ¼å¼
- æ–‡ä»¶ä½“ç§¯é€šå¸¸å°äº PDF

## âš™ï¸ é…ç½®æ–¹å¼

### ä¼˜å…ˆçº§

å‘½ä»¤è¡Œå‚æ•° > é…ç½®æ–‡ä»¶

### é…ç½®æ–‡ä»¶ç¤ºä¾‹

åˆ›å»º `config.json`ï¼ˆå¯é€‰ï¼‰ï¼š

```json
{
  "cookie": "ä½ çš„å®Œæ•´ cookie å­—ç¬¦ä¸²",
  "columnUrl": "https://time.geekbang.org/column/article/xxxxx"
}
```

**æ³¨æ„**ï¼š
- Cookie å¿…é¡»å®Œæ•´ï¼ŒåŒ…å«æ‰€æœ‰è®¤è¯ä¿¡æ¯
- columnUrl å¯ä»¥æ˜¯ä¸“æ ä»»æ„ä¸€ç¯‡æ–‡ç« çš„ URL
- Cookie æœ‰è¿‡æœŸæ—¶é—´ï¼Œå¤±è´¥æ—¶è¯·é‡æ–°è·å–
- é…ç½®æ–‡ä»¶å®Œå…¨å¯é€‰ï¼Œä¹Ÿå¯çº¯å‘½ä»¤è¡Œä½¿ç”¨

## ğŸ› å¸¸è§é—®é¢˜

### Playwright æµè§ˆå™¨æœªå®‰è£…ï¼Ÿ

å¦‚æœé‡åˆ° "Executable doesn't exist" é”™è¯¯ï¼Œè¯´æ˜ Playwright æµè§ˆå™¨æœªå®‰è£…ã€‚

**æ–¹å¼ä¸€ï¼šè‡ªåŠ¨å®‰è£…ï¼ˆæ¨èï¼‰**
```bash
# å…¨å±€å®‰è£…ä¼šè‡ªåŠ¨å®‰è£…æµè§ˆå™¨
npm install -g @kadaliao/geektime-downloader
```

**æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£…æµè§ˆå™¨**
```bash
# åªå®‰è£… Chromium
npx playwright install chromium

# æˆ–å®‰è£…æµè§ˆå™¨åŠç³»ç»Ÿä¾èµ–ï¼ˆLinux/Macï¼‰
npx playwright install chromium --with-deps
```

**æ³¨æ„**ï¼šä½¿ç”¨ `npx` ç›´æ¥è¿è¡Œæ—¶ï¼Œå¯èƒ½éœ€è¦å…ˆæ‰‹åŠ¨å®‰è£…æµè§ˆå™¨ã€‚ä¸ºäº†æ›´å¥½çš„ä½“éªŒï¼Œå»ºè®®å…¨å±€å®‰è£…ã€‚

### Cookie å’Œ URL å¿…é¡»é€šè¿‡å‘½ä»¤è¡Œä¼ å—ï¼Ÿ

ä¸æ˜¯ã€‚ä¸‰ç§æ–¹å¼ä»»é€‰ï¼š
1. **çº¯å‘½ä»¤è¡Œ**ï¼š`npx @kadaliao/geektime-downloader -u "..." -c "..."`
2. **é…ç½®æ–‡ä»¶**ï¼šåˆ›å»º `config.json` åç›´æ¥è¿è¡Œ
3. **æ··åˆä½¿ç”¨**ï¼šå‘½ä»¤è¡Œå‚æ•°ä¼šè¦†ç›–é…ç½®æ–‡ä»¶

### Cookie è¿‡æœŸäº†æ€ä¹ˆåŠï¼Ÿ

é‡æ–°è·å– Cookie å¹¶æ›´æ–°ï¼š
- å‘½ä»¤è¡Œæ–¹å¼ï¼š`-c "æ–°cookie"`
- é…ç½®æ–‡ä»¶æ–¹å¼ï¼šæ›´æ–° `config.json`

### PDF å†…å®¹ä¸å®Œæ•´ï¼Ÿ

å¢åŠ é¡µé¢åŠ è½½å»¶è¿Ÿï¼š

```bash
npx @kadaliao/geektime-downloader -u "..." -c "..." --delay 5000
```

### å¦‚ä½•ä¸‹è½½å¤šä¸ªä¸“æ ï¼Ÿ

æ¯æ¬¡è¿è¡Œä¸‹è½½ä¸€ä¸ªï¼Œåªéœ€æ›´æ”¹ URLï¼š

```bash
npx @kadaliao/geektime-downloader -u "ä¸“æ Açš„URL" -c "..."
npx @kadaliao/geektime-downloader -u "ä¸“æ Bçš„URL" -c "..."
```

## ğŸ›  æœ¬åœ°å¼€å‘

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/geektime-downloader.git
cd geektime-downloader

# å®‰è£…ä¾èµ–
npm install

# å®‰è£…æµè§ˆå™¨
npx playwright install chromium

# æœ¬åœ°æµ‹è¯•
npm link
geektime-dl --help
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
geektime-downloader/
â”œâ”€â”€ download.js           # ä¸»ç¨‹åº
â”œâ”€â”€ package.json          # npm é…ç½®
â”œâ”€â”€ config.example.json   # é…ç½®æ¨¡æ¿
â”œâ”€â”€ README.md             # ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ PUBLISH.md            # å‘å¸ƒæŒ‡å—ï¼ˆç»´æŠ¤è€…ï¼‰
â””â”€â”€ .gitignore            # Git å¿½ç•¥è§„åˆ™
```

## ğŸ¯ æŠ€æœ¯æ ˆ

- **Playwright**: æµè§ˆå™¨è‡ªåŠ¨åŒ–
- **Commander**: å‘½ä»¤è¡Œè§£æ
- **Chalk**: å½©è‰²è¾“å‡º
- **Ora**: è¿›åº¦æç¤º
- **pdf-lib**: PDF æ–‡æ¡£æ“ä½œå’Œåˆå¹¶
- **epub-gen-memory**: EPUB ç”µå­ä¹¦ç”Ÿæˆ

## ğŸ“„ License

MIT

## âš ï¸ å…è´£å£°æ˜

æœ¬å·¥å…·ä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºå•†ä¸šç”¨é€”ã€‚ä¸‹è½½å†…å®¹ç‰ˆæƒå½’æå®¢æ—¶é—´æ‰€æœ‰ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚
